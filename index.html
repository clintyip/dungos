<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gachapon Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            background-color: #333; /* Dark mode background color */
            color: #f0f0f0; /* Dark mode text color */
            transition: background-color 0.3s, color 0.3s;
        }
        body.light-mode {
            background-color: #f0f0f0; /* Light mode background color */
            color: #333; /* Light mode text color */
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 24px;
            margin-bottom: 10px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #007bff;
        }
        input:checked + .slider:before {
            transform: translateX(16px);
        }
        .slider.round {
            border-radius: 24px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        .button {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
        }
        .button:hover {
            background-color: #0056b3;
        }
        #container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 800px;
            height: 100%;
        }
        #results {
            text-align: left;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            flex-grow: 1;
            overflow-y: auto;
            width: 100%;
        }
        #output {
            margin-top: 10px;
            text-align: left;
        }
        #totals {
            margin-top: 10px;
            list-style-type: none;
            padding: 0;
            text-align: left;
        }
        #counters {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 20px;
        }
        .counter {
            flex-basis: 50%;
            text-align: center;
        }
        #coinCount {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
        .radial-button {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin: 0 5px;
            cursor: pointer;
        }
        .common { background-color: #fff; }
        .uncommon { background-color: #0f0; }
        .rare { background-color: #00f; }
    </style>
</head>
<body class="dark-mode"> <!-- Default to dark mode -->
    <h1>Gachapon Simulator</h1>

    <div id="container">
        <div>
            <button class="button" onclick="drawGachapon(1)">1 Draw</button>
            <button class="button" onclick="drawGachapon(5)">5 Draws</button>
            <button class="button" onclick="drawGachapon(10)">10 Draws</button>
            <button class="button" onclick="resetSimulation()">Reset</button>
        </div>

        <div id="results">
            <div id="output"></div>
            <ul id="totals"></ul>
        </div>

        <div id="counters">
            <div class="counter" id="pityCounterHits">Pity Counter Hits: 0</div>
            <div class="counter" id="untilPity">Until Pity: 10</div>
        </div>

        <div id="coinCount">
            Coins: <input type="number" id="coinInput" value="10000" min="0">
        </div>

        <div>
            <div class="radial-button common" onclick="setRarity('common')"></div>
            <div class="radial-button uncommon" onclick="setRarity('uncommon')"></div>
            <div class="radial-button rare" onclick="setRarity('rare')"></div>
        </div>

        <label class="switch">
            <input type="checkbox" checked onclick="toggleDarkMode()">
            <span class="slider round"></span>
        </label>
    </div>

    <script>
        const items = [
            'Berserker\'s armor', 'BF Cannon', 'Big Club', 'Chumby Chicken', 'Cleansing Flames',
            'Curse of Exhaustion', 'Dark Ritual', 'Draining Dagger', 'Fiery Thorns', 'Fire Sword',
            'Halberd', 'Healing Pendant', 'Love Letter', 'Magic Parasol', 'Martyr Armor',
            'Mocking Armor', 'Pet Imp', 'Poison Dagger', 'Riot Shield', 'Rock Companion',
            'Sacrificial Tome', 'Seeking Missiles', 'Special Delivery', 'Survival Kit',
            'Whirlwind Axe', 'Witch\'s Armor', 'Boosting Bugle', 'Challenger Arrow',
            'Energetic Ally', 'Explosion Powder', 'Festive Feast', 'Freezing Popsicle',
            'Knight\'s Lance', 'Plague Bringer', 'POGable Forge', 'Punching Bag', 'The BOX'
        ];

        const tiers = [
            { name: '1', probability: 0.4 },
            { name: '2', probability: 0.5 },
            { name: '3', probability: 0.08 },
            { name: '4', probability: 0.02 }
        ];

        let pityCounter = 0;
        let pityCounterHits = 0;
        let untilPity = 10;
        let results = {
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0
        };
        let drawHistory = [];
        let selectedRarity = 'common';

        function drawGachapon(numDraws) {
            const coinsInput = document.getElementById('coinInput');
            let coins = parseInt(coinsInput.value);

            const costPerDraw = getCoinCost(selectedRarity);
            const totalCost = costPerDraw * numDraws;

            if (coins < totalCost) {
                alert('Not enough coins!');
                return;
            }

            coins -= totalCost;
            coinsInput.value = coins;

            for (let i = 0; i < numDraws; i++) {
                let random = Math.random();
                let cumulativeProbability = 0;

                pityCounter++;
                untilPity--;

                if (pityCounter >= 10) {
                    pityCounter = 0;
                    pityCounterHits++;
                    untilPity = 10;
                    if (Math.random() < 0.8) {
                        pullItem('3');
                    } else {
                        pullItem('4');
                    }
                    continue;
                }

                for (let tier of tiers) {
                    cumulativeProbability += tier.probability;
                    if (random < cumulativeProbability) {
                        pullItem(tier.name);
                        if (tier.name === '3' || tier.name === '4') {
                            pityCounter = 0;
                            untilPity = 10;
                        }
                        break;
                    }
                }
            }

            updateResults();
        }

        function getCoinCost(rarity) {
            switch (rarity) {
                case 'common':
                    return 200;
                case 'uncommon':
                    return 600;
                case 'rare':
                    return 1200;
                default:
                    return 200;
            }
        }

        function pullItem(tierName) {
            let selectedItem = items[Math.floor(Math.random() * items.length)];
            results[tierName]++;
            drawHistory.push(`${selectedItem} ${tierName}`);
        }

        function updateResults() {
            let outputDiv = document.getElementById('output');
            let totalsList = document.getElementById('totals');

            outputDiv.innerHTML = '';
            totalsList.innerHTML = '';

            drawHistory.forEach(item => {
                let p = document.createElement('p');
                p.textContent = item.split(' ')[1]; // Output only the tier number
                outputDiv.appendChild(p);
            });

            tiers.forEach(tier => {
                let li = document.createElement('li');
                li.textContent = `Tier ${tier.name}: ${results[tier.name]}`;
                totalsList.appendChild(li);
            });

            document.getElementById('pityCounterHits').textContent = `Pity Counter Hits: ${pityCounterHits}`;
            document.getElementById('untilPity').textContent = `Until Pity: ${untilPity}`;
        }

        function setRarity(rarity) {
            selectedRarity = rarity;
            document.querySelectorAll('.radial-button').forEach(btn => {
                btn.style.border = btn.classList.contains(rarity) ? '2px solid #fff' : '2px solid transparent';
            });
        }

        function resetSimulation() {
            pityCounter = 0;
            pityCounterHits = 0;
            untilPity = 10;
            results = {
                '1': 0,
                '2': 0,
                '3': 0,
                '4': 0
            };
            drawHistory = [];
            updateResults();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('light-mode');
        }
    </script>
</body>
</html>
